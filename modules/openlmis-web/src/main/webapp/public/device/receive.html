<!--
  ~ This program is part of the OpenLMIS logistics management information system platform software.
  ~
  ~ This program is free software: you can redistribute it and/or modify it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.
  ~  
  ~ This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Affero General Public License for more details.
  ~ You should have received a copy of the GNU Affero General Public License along with this program.  If not, see http://www.gnu.org/licenses.  For additional information contact info@OpenLMIS.org. 
  -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
    <script src="js/jquery-1.11.3.min.js"></script>
    <!--<script src="js/queryScript.js"></script>-->
</head>
<body>
<h1 style="background-color:#E6E6FA;">Electronic Logistics Management Information System( ELMIS )</h1>
<div class="contents">
    <form>
        <fieldset>
            <legend>Scan the SSCC</legend>
            <input type="text" name="shipment_id" id="shipment_id" /> &nbsp;&nbsp;&nbsp;
            <input type="button" value="Scan"  id="scan_sscc"/>
        </fieldset>
    </form>
    <div class="result"></div>
    <p id="message"><img src="../images/ajax-loader.gif" alt=""/></p>
</div>
<script>
    $(document).ready(function(){
        alert('ready1');
        $("#message").hide();
        $("#shipment_id").focus();
        $( "#scan_sscc" ).click(function() {

            $("#message").show();
            $(".result").hide();
            if($("#shipment_id").val() != ""){
                alert('ready1');
                $.ajax({
                    method: 'GET',
                    url: '/stock/manufacture/package?filter=shipment_id:eq:'+$("#shipment_id").val(),
                    headers: {'Content-Type': 'application/x-www-form-urlencoded'},
                }).success(function(data) {
                    if(!data.error){
                        if(data.manufacture_packages.length == 0){
                            $(".result").show().html('<h4>There is no package with this package number</h4>');
                        }else{
                            $(".result").html("");
                            var html = "<table border='1' cellpadding='0' cellspacing='0'>";
                            html +="<tr>";
                            html +="<th>GTIN</th>";
                            html +="<th>Item</th>";
                            html +="<th>Lot Number</th>";
                            html +="<th>Expiry</th>";
                            html +="<th>Boxes</th>";
                            html +="</tr>";
                            $.each(data.manufacture_packages, function(index, element) {
                                html +="<tr>";
                                html +="<td>"+element.vaccine_packaging.gtin+"</td>";
                                html +="<td>BCG</td>";
                                html +="<td>"+element.lot_number+"</td>";
                                html +="<td>"+element.expire_date+"</td>";
                                html +="<td>"+parseInt(element.number_of_doses/(element.vaccine_packaging.doses_per_vial*element.vaccine_packaging.vials_per_box))+"</td>";
                                html +="</tr>";

                            });
                            html +="</table>";
                            $(".result").show().html(html);

                        }

                    }else{
                        $("#message").hide();
                    }
                    $("#message").hide();

                }).error(function(data){
                   alert('error');
                });
            }

        });


    });
</script>

</body>
</html>
